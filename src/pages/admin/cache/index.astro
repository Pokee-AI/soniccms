---
import { getAdminKvData } from "@services/kv-data";
import { apiConfig } from "../../../db/routes";
import AdminLayout from "../layouts/admin-layout.astro";
import TableCacheRequests from "components/table-cache-requests";
import { getFieldDefinitions } from "@services/fields";

// const data = await getAdminKvData(Astro);

const tableConfigRecord = apiConfig.find((t) => t.route === "cache-requests");
const tableConfig = getFieldDefinitions(tableConfigRecord);

//remove fields

tableConfig.formFields = tableConfig.formFields.filter(
  (f) => f.key !== "createdOn"
);

tableConfig.formFields = tableConfig.formFields.filter(
  (f) => f.key !== "updatedOn"
);

tableConfig.formFields = tableConfig.formFields.filter(
  (f) => f.key !== "deletedOn"
);
//add fields

tableConfig.formFields.push({
  key: "createdOnAgo",
  label: "Created On",
  type: "textField",
});

tableConfig.formFields.push({
  key: "matchingKvRecord",
  label: "Matching KV Record",
  type: "textField",
});

tableConfig.formFields.push({
  key: "kvUpdatedOnAgo",
  label: "KV Updated",
  type: "textField",
});

tableConfig.formFields.push({
  key: "kvTTL",
  label: "KV TTL",
  type: "textField",
});

let x;
---

<AdminLayout title=`SonicJs Admin` | Cache `>



  <div>
    <TableCacheRequests client:load tableConfig={tableConfig} />
  </div>
  <p>
    cache request page, <br />show if data and kv list in sync.
    <br />if not, sync not, show total count records and kv entires.
    <br />show green dot next to record indicating it has associated kv entry.
    <br />show last sync date and time. (sync'd 3 days ago)
    <br />sync now for each record
    <br />really need to know that cached data is not stale regardless of record
    and kv entry
  </p>

  <!-- <div>
    KV Count: {data.kvRecordsCount} | Records Count: {data.cacheRequestsCount}
  </div> -->

</AdminLayout>
