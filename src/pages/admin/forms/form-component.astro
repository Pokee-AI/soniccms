---
import { apiConfig } from "../../../db/routes";
import { getFieldDefinitions } from "../../../services/fields";
import TextField from "./fields/text-field.astro";
import TextArea from "./fields/text-area.astro";
import FileUploadField from "./fields/file-upload-field.astro";

const { record, title = "Edit" } = Astro.props;
const { form } = Astro.params;
const tableConfigRecord = apiConfig.find((t) => t.route === form);
const tableConfig = getFieldDefinitions(tableConfigRecord, record);
---

<form method="post">
  <div class="space-y-12 mx-auto max-w-7xl">
    <div class="border-b border-white/10 pb-12">
      <h2 class="text-base font-semibold leading-7 text-white">
        {title}
        {tableConfigRecord.name}
      </h2>

      <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
        <div class="sm:col-span-4">
          {
            tableConfig.formFields.map((field) => (
              <div class="mt-4">
                {(field.key.includes('MediaUrls') && field.type === "textField") ? (
                  <FileUploadField field={field} record={record} />
                ) : field.type === "textArea" ? (
                  <TextArea field={field} />
                ) : (
                  <TextField field={field} />
                )}
              </div>
            ))
          }

          <div class="mt-6 flex items-center justify-end gap-x-6">
            <a
              href={`/admin/tables/${form}`}
              class="rounded-md bg-gray-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-500"
              >Cancel</a
            >
            <button
              type="submit"
              class="rounded-md bg-indigo-500 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500"
              >Save</button
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
